
# openCEM Post Processing
A set of tools for visualising data outputted by [openCEM](github.com/openCEMorg/openCEM).

## Dependencies
This code requires 'Python3'. Dependencies can be installed using pip with the provided requirements file.
```bash
$> pip install -r requirements.txt
```

## Specifying File Paths
Several paths and constants must be properly specified for the code to properly to execute. A file called `config.ini` is provided with the repository. Inside this file are two local paths: `json_path` and `db_path`. For `json_path` users must specify folder which contains the JSON file being processed. For `db_path` users specify a path including a filename for the database file which will be generated from the JSON file. `json_name` specifies the actual file in `json_path` to be processed.

For example:
```
[local]
json_path = C:\Users\HomerS\Documents\myopenCEMresuls
db_path = C:\Users\HomerS\Documents\myopenCEMresuls\scenario01.db
json_name = scenario01.json
```

## Generate a database File
Database files (extension `.db`) are generated by calling the `generate_db.py` script in the base repository directory.
Calling this script will read in the JSON file specified in the configuration and produce a datatabase file with the path specified. This can be a time intensive process and may take up to 20-30 minutes for machines with 8GB or less RAM.

**NOTE** Ensure before each .db file is generated that another file with the same filename does not exist in the directory being saved to. Otherwise incorrect data will be generated and processed. This can be avoided by deleting or changing the name of the existing file.

### Generating a Report
Once the database file has been generated reports can also be generated. This is done by calling the `autoreporting.py` script contained in the main directory. This will create a folder in the `json_path` directory with the same name as the JSON file. Therein a report and associated files is generated in html format. This file is best opened in a web browser.

Depending upon the specific scenario being modelled, not all data may be available to produce all plots and tables within the report. If this is the case, text will instead be generated to describe this.  

## Additinal documentation

Additional documentation can be found in the `docs` folder of this repository.

More detailed processing can be achieved through direct use of the plotting classes. These are contained in the Processing subfolder. There are two main classes: OutputsAnimator and OutputsPlotter. There are within the 'animating.py' and 'plotting.py' files, respectively.

Theese must be called from within the main directory; cemo_outputs and not the Processing subdirectory.  
### Custom Animations
These can be produced using the OutputsAnimator class. From within the main repo directory this can be done as follows:


```python
#import animating class
from Processing.animating import OutputsAnimator

#initalise animator class
animator = OutputsAnimator()

#specify start date
start_date = '23/4/2030'
#specify days to animate for
num_days = 3
#generate animation
animator.main(start_date, num_days)
```

This the oututs the animation as a gif file to the Animation subfolder.

An important thing to note when specifying dates is that the model treats years as financial rather than calendar years. For example for the year '2030', the dates specified must fall within the range of '2029-07-01' and '2030-06-30.'

Additionally, the functions used to parse dates will favour American formats. The data '3/12/2030' will be interpreted as the 12th of March rather than the 3rd of December.

### Custom Plots
Custom plots of both a generation slice or the yearly capacity and generation can be produced using the OutputsAnimator class. In this case, the data also needs to be loaded using the SqlFile class.


```python
#import plotting class
from Processing.plotting import OutputsPlotter
#import sql data class
from Processing.loader import SqlFile

#load the model data
model_data = SqlFile()
model_data.load_all_data()

#initialise plotting class
plotter = OutputsPlotter()
```


```python
#plotting yearly capacity and generation data
plotter.plot_yearly_cap(model_data)
```


![png](/docs/img/output_8_0.png)


This plot can also be made specific to either the state or ntndp zone id. The state should be inputted as a string as one of 'QLD', 'NSW', 'SA', 'VIC' or 'TAS'. The ntndp zone id should be inputted as an integer between 1 and 16. For example:


```python
plotter.plot_yearly_cap(model_data, 'SA')
```


![png](/docs/img/output_10_0.png)


Plotting of the generation slice also has the option to be made region specific, using the same method. This plot also requires a start date and number of days to specified as shown below:


```python
#specify start date
start_date = '23/4/2030'
#specify days to animate for
num_days = 3
#make plot
plotter.plot_generation_slice(model_data, start_date, num_days)
```


![png](/docs/img/output_12_0.png)


And when specifying the region:


```python
plotter.plot_generation_slice(model_data, start_date, num_days, 'NSW')
```


![png](/docs/img/output_14_0.png)
